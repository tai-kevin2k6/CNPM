@page "/register"
@inject HttpClient Http
@layout Layout.LoginLayout
@using MyBlazorApp.Components.Model
@inject NavigationManager NavManager
<h3 class="title">Đăng ký</h3>

<div class="form mt-4">
    <div class="row">
        <label>Họ và tên</label>
        <input @bind="model.FullName" />
    </div>

    <div class="row">
        <label>Số điện thoại</label>
        <input type="tel" @bind="model.PhoneNumber" />
    </div>

    <div class="row">
        <label>Username/Email: </label>
        <input type="text" @bind="model.Username" />

    </div>
    <div class="row">
        <label>Mật khẩu:</label>
        <input type="password" @bind="model.Password" />
    </div> 
    <div class="row">
        <label>Vai trò: </label>
        <div>
            <input type="radio" class="role-radio"
                   name="Role"
                   value="Khách hàng"
                   @onchange="SelectRole1" /> <a class="TextA">Khách hàng</a>

            <input type="radio" class="role-radio"
                   name="Role"
                   value="Chủ tiệm"
                   @onchange="SelectRole2" />  <a class="TextA">Chủ điểm</a>
        </div>

    </div>
    <span asp-validation-for="Role" class="text-danger"></span>
</div>
<p>@message</p><div class="mt-3">
<button class="btn btn-primary center-block-button" @onclick="RegisterUser">Đăng ký</button>
</div>
@code {
    RegisterRequest model = new();
    string message = "";

    async Task RegisterUser()
    {
        string url = model.Role == "HubOwner"
        ? "api/auth/hub-register"
        : "api/auth/user-register";
        var response = await Http.PostAsJsonAsync(url, model);

        if (response.IsSuccessStatusCode)
        {
            message = await response.Content.ReadAsStringAsync();
        }
        else
        {
            message = await response.Content.ReadAsStringAsync();
        }
        NavManager.NavigateTo("/login");
    }
    private void SelectRole1()
    {
        model.Role = "Customer";
    }
    private void SelectRole2()
    {
        model.Role = "Owner";
    }
}

