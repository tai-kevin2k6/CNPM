@page "/register"
@inject HttpClient Http
@layout Layout.LoginLayout
@using MyBlazorApp.Components.Model
@inject NavigationManager NavManager
<div class="register-page">
<div class="register-box">
    <div class="user-icon">
        <img src="/user-icon.png" alt="user-icon" />
    </div>
    <div class="form mt-4">
        <div class="row">
            <label>Họ và tên</label>
            <input @bind="model.FullName" />
        </div>

        <div class="row">
            <label>Số điện thoại</label>
            <input type="tel" @bind="model.PhoneNumber" />
        </div>

        <div class="row">
            <label>Username/Email: </label>
            <input type="text" @bind="model.Username" />
        </div>
        <div class="row">
            <label>Mật khẩu:</label>
            <input type="password" @bind="model.Password" />
        </div> 
        <div class="row">
            <label>Vai trò: </label>
            <div class="role-group">
                <label class="role-item">
                    <input type="radio" name="role" class="role-radio">
                    <span>Khách hàng</span>
                </label>

                <label class="role-item">
                    <input type="radio" name="role" class="role-radio">
                    <span>Chủ điểm</span>
                </label>
            </div>
        </div>
        <span asp-validation-for="Role" class="text-danger"></span>
    </div>
    <p>@message</p>
    <div class="mt-3">
    <button class="btn btn-primary center-block-button" @onclick="RegisterUser">Đăng ký</button>
    </div>
</div>
</div>
@code {
    RegisterRequest model = new();
    string message = "";

    async Task RegisterUser()
    {   
        if (string.IsNullOrEmpty(model.Role))
        {
            message = "Vui lòng chọn vai trò";
            return;
        }
        string url = model.Role == "HubOwner"
        ? "api/auth/hub-register"
        : "api/auth/user-register";

        var response = await Http.PostAsJsonAsync(url, model);

        message = await response.Content.ReadAsStringAsync();

        if (response.IsSuccessStatusCode)
            NavManager.NavigateTo("/login");
    }
}

