@page "/register"
@using CNPM.Client.Models
@inject HttpClient Http
@inject NavigationManager Nav

<div class="login-page-bg">
    <div class="glass-card" style="width: 100%; max-width: 750px;">
        <div class="login-icon-wrapper">
            <img src="/images/user-icon.png" alt="User Icon" class="login-icon" />
        </div>
        <h2 style="text-align:center; margin-bottom: 1.5rem; color: var(--primary-color); font-weight: 800; font-size: 25px;">ĐĂNG KÝ TÀI KHOẢN</h2>

        <div style="margin-bottom: 15px;">
            <label style="font-weight:600; display:block; margin-bottom:5px; border-radius: 16px;">Họ và tên</label>
            <input @bind="regModel.FullName" class="form-control-custom" placeholder="Ví dụ: Nguyễn Văn A" />
        </div>

        <div style="margin-bottom: 15px;">
            <label style="font-weight:600; display:block; margin-bottom:5px;">Số điện thoại</label>
            <input @bind="regModel.PhoneNumber" class="form-control-custom" placeholder="Nhập SĐT (trên 10 số)..." />
        </div>

        <div style="margin-bottom: 15px;">
            <label style="font-weight:600; display:block; margin-bottom:5px;">Mật khẩu</label>
            <input type="password" @bind="regModel.Password" class="form-control-custom" placeholder="Mật khẩu (trên 6 ký tự)..." />
        </div>

        <div style="margin-bottom: 25px;">
            <label style="font-weight:600; display:block; margin-bottom:5px;">Vai trò</label>
            <select @bind="regModel.Role" class="form-control-custom" style="background-color: white;">
                <option value="User">Khách hàng cá nhân</option>
                <option value="HubOwner">Chủ điểm giao nhận</option>
            </select>
        </div>

        <button class="btn-primary-custom" style="width:100%" @onclick="HandleRegister">ĐĂNG KÝ NGAY</button>

        <div style="text-align:center; margin-top:20px;">
            <a href="login" style="color: var(--secondary-color); text-decoration:none;">Đã có tài khoản? <b>Đăng nhập</b></a>
        </div>

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div style="background:#fee2e2; color:#b91c1c; padding:10px; border-radius:8px; margin-top:15px; text-align:center; font-size: 14px;">
                @errorMessage
            </div>
        }
    </div>
</div>

<style>
    /*icon*/
    .login-icon-wrapper {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 12px;
    }

    .login-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        padding: 16px;
        background: rgba(255, 255, 255, 0.6);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    /* Dùng chung style nền với trang Login để đồng bộ */
    .login-page-bg {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient( to bottom, #2563eb 0%, #60a5fa 40%, #ffffff 100% );
    }
</style>

@code {
    private RegisterRequest regModel = new RegisterRequest();
    private string errorMessage;

    private async Task HandleRegister()
    {
        // 1. Validate nhanh
        if (string.IsNullOrEmpty(regModel.FullName)) { errorMessage = "Vui lòng nhập họ tên!"; return; }
        if (string.IsNullOrEmpty(regModel.PhoneNumber) || regModel.PhoneNumber.Length < 10) { errorMessage = "Số điện thoại không hợp lệ!"; return; }
        if (string.IsNullOrEmpty(regModel.Password)) { errorMessage = "Mật khẩu quá ngắn!"; return; }

        try
        {
            // 2. Gọi API
            var response = await Http.PostAsJsonAsync("api/Auth/register", regModel);

            if (response.IsSuccessStatusCode)
            {
                // Thành công -> Chuyển về login
                Nav.NavigateTo("/login");
            }
            else
            {
                errorMessage = await response.Content.ReadAsStringAsync();
            }
        }
        catch (Exception ex)
        {
            errorMessage = "Lỗi kết nối Server: " + ex.Message;
        }
    }
}